AIRFLOW_IMAGE_NAME=apache/airflow:2.8.1
AIRFLOW_UID=50000
_AIRFLOW_WWW_USER_USERNAME=airflow
_AIRFLOW_WWW_USER_PASSWORD=airflow
_PIP_ADDITIONAL_REQUIREMENTS=pandas matplotlib seaborn scikit-learn

# =============================================================================
# CONFIGURACIÓN DE CELERY - Prevención de sobrecarga de recursos
# =============================================================================
AIRFLOW__CELERY__WORKER_CONCURRENCY=4
AIRFLOW__CELERY__WORKER_PREFETCH_MULTIPLIER=1
AIRFLOW__CELERY__WORKER_MAX_TASKS_PER_CHILD=100
AIRFLOW__CELERY__TASK_TIME_LIMIT=1800
AIRFLOW__CELERY__TASK_SOFT_TIME_LIMIT=1500
AIRFLOW__CELERY__WORKER_AUTOSCALE=8,2

# =============================================================================
# CONFIGURACIÓN DE SCHEDULER - Detección y limpieza de zombie jobs
# =============================================================================
AIRFLOW__SCHEDULER__ZOMBIE_TASK_THRESHOLD=300
AIRFLOW__SCHEDULER__SCHEDULER_ZOMBIE_TASK_THRESHOLD=300
AIRFLOW__SCHEDULER__SCHEDULER_HEALTH_CHECK_THRESHOLD=30
AIRFLOW__SCHEDULER__PARSING_PROCESSES=2
AIRFLOW__SCHEDULER__MAX_DAGRUNS_TO_CREATE_PER_LOOP=10
AIRFLOW__SCHEDULER__MIN_FILE_PROCESS_INTERVAL=30
AIRFLOW__SCHEDULER__DAG_DIR_LIST_INTERVAL=300
AIRFLOW__SCHEDULER__CATCHUP_BY_DEFAULT=False

# =============================================================================
# CONFIGURACIÓN DE CORE - Límites de paralelismo y concurrencia
# =============================================================================
AIRFLOW__CORE__PARALLELISM=32
AIRFLOW__CORE__DAG_CONCURRENCY=16
AIRFLOW__CORE__MAX_ACTIVE_RUNS_PER_DAG=1
AIRFLOW__CORE__KILLED_TASK_CLEANUP_TIME=86400
AIRFLOW__CORE__DAGBAG_IMPORT_TIMEOUT=30
AIRFLOW__CORE__MAX_ACTIVE_TASKS_PER_DAG=16

# =============================================================================
# CONFIGURACIÓN DE LOGGING - Optimización de logs
# =============================================================================
AIRFLOW__LOGGING__LOGGING_LEVEL=INFO
AIRFLOW__LOGGING__FAB_LOGGING_LEVEL=WARNING
AIRFLOW__LOGGING__BASE_LOG_FOLDER=/opt/airflow/logs
AIRFLOW__LOGGING__DAG_PROCESSOR_MANAGER_LOG_LOCATION=/opt/airflow/logs/dag_processor_manager/dag_processor_manager.log

# =============================================================================
# CONFIGURACIÓN DE WEBSERVER - Límites de workers
# =============================================================================
AIRFLOW__WEBSERVER__WORKERS=2
AIRFLOW__WEBSERVER__WORKER_REFRESH_INTERVAL=1800
AIRFLOW__WEBSERVER__WEB_SERVER_WORKER_TIMEOUT=120

# =============================================================================
# CONFIGURACIÓN DE BASE DE DATOS - Pool de conexiones
# =============================================================================
AIRFLOW__DATABASE__SQL_ALCHEMY_POOL_SIZE=10
AIRFLOW__DATABASE__SQL_ALCHEMY_MAX_OVERFLOW=20
AIRFLOW__DATABASE__SQL_ALCHEMY_POOL_RECYCLE=3600
AIRFLOW__DATABASE__SQL_ALCHEMY_POOL_PRE_PING=True